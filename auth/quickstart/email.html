<!DOCTYPE html>
<!--
Copyright (c) 2016 Google Inc.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->
<html>
<head>
  <meta charset=utf-8 />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Email/Password Authentication Example</title>

  <!-- Material Design Theming -->
  <link rel="stylesheet" href="https://code.getmdl.io/1.1.2/material.orange-indigo.min.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <script defer src="https://code.getmdl.io/1.1.2/material.min.js"></script>

  <!-- Firebase Auth -->
  <script type="text/javascript">
    /**************************************************
     * TODO(DEVELOPER): Change these config variable. *
     **************************************************/
    var apiKey = 'YOUR_API_KEY_HERE';
    var databaseUrl = 'YOUR_DATABASE_URL_HERE';
  </script>

  <script src="https://www.gstatic.com/firebasejs/3.0.0-eap.2/firebase.js"></script>
  <script type="text/javascript">
    var app = null;
    var auth = null;

    /*
     * Handle the sign in button press.
     *
     * Sign in status persists between page reloads, so we check status using
     * |currentUser| on the Firebase auth object.
     *
     * auth.signOut clears the current session.
     *
     * auth.signInWithEmailPassword takes the ID token we have generated from
     * our own authentication system and passes it to the Firebase Auth backend.
     * We can check for the result in the callback, or monitor the auth status
     * separately (see initApp for that part).
     */
    function handleSignIn() {
      if (auth.currentUser) {
        // [START signout]
        auth.signOut().then(function() {
          // Signout complete.
          console.log('Signed Out');
        }, function(error) {
          console.error('Sign Out Error', error);
        });
        // [END signout]
      } else {
        var email = document.getElementById('email').value;
        var password = document.getElementById('password').value;
        if (email.length < 4) {
          alert('Please enter an email address.');
          return;
        }
        if (password.length < 4) {
          alert('Please enter a password.');
          return;
        }
        // Sign in with email and pass.
        // [START authwithemail]
        auth.signInWithEmailAndPassword(email, password).then(function(user) {
          console.log('Sign In Success', user);
        }, function(error) {
          console.error('Sign In Error', error);
        });
        // [END authwithemail]
      }
    }

    function handleSignUp() {
      var email = document.getElementById('email').value;
      var password = document.getElementById('password').value;
      if (email.length < 4) {
        alert('Please enter an email address.');
        return;
      }
      if (password.length < 4) {
        alert('Please enter a password.');
        return;
      }
      // Sign in with email and pass.
      // [START createwithemail]
      auth.createUserWithEmailAndPassword(email, password).then(function(user) {
        console.log('Create user and sign in Success', user);
      }, function(error) {
        console.error('Create user and sign in Error', error);
      });
      // [END createwithemail]
    }

    /**
     * initApp handles setting up the Firebase context and registering
     * callbacks for the auth status.
     *
     * The core initialization is in firebase.App - this is the glue class
     * which stores configuration. We provide an app name here to allow
     * distinguishing multiple app instances.
     *
     * This method also registers a listener with app.addAuthStateListener.
     * This listener is called when the user is signed in or out, and that
     * is where we update the UI.
     *
     * When signed in, we also authenticate to the Firebase Realtime Database.
     * In this alpha version of the library we do that by retrieving a token
     * from the Secure Token Service
     */
    function initApp() {
      console.log('Initializing App');
      // Check preconditions.
      if (databaseUrl.indexOf('firebaseio') < 0 || apiKey.indexOf('AI') < 0) {
        console.log('Enter your config values for apiKey and databaseUrl');
        alert('Enter your config values for apiKey and databaseUrl');
        return;
      }

      // [START appconfig]
      // Api key in config.
      var config = {
        apiKey: apiKey,
        databaseUrl: databaseUrl
      };
      app = firebase.App.initialize(config);
      auth = app.auth();
      // [END appconfig]

      console.log('Adding auth state listener');
      // Auth state changes.
      // [START authstatelistener]
      app.addAuthStateListener(function(event) {
        // Current user.
        var user = event.user;
        var getToken = event.getToken;
        console.log('User Object:', user);

        if (!user) {
          document.getElementById('signin').textContent = 'Sign In';
          document.getElementById('signup').disabled = false;
          return;
        }
        document.getElementById('signup').disabled = true;
        document.getElementById('signin').textContent = 'Sign Out';
        alert('Welcome UID:' + user.uid);

        // [START_EXCLUDE]
        var myFirebaseRef = app.database().ref();
        myFirebaseRef.on('value', function(snapshot) {
          console.log('Database snapshot:', snapshot.val());
        });
        // [END_EXCLUDE]
      }, function(error) {
        console.error('Auth Listener Error', error);
      });
      // [END authstatelistener]

      document.getElementById('signin').addEventListener('click', handleSignIn, false);
      document.getElementById('signup').addEventListener('click', handleSignUp, false);
    }

    window.onload = function() {
      initApp();
    };
  </script>
</head>
<body>
  <div class="mdl-layout" id="content">
    <header class="mdl-layout__header mdl-grid">
      <h1>Firebase Email &amp; Password Authentication</h1>
    </header>
    <main class="mdl-layout__content">
      <div class="mdl-grid">
        <div class="mdl-layout-spacer"></div>
        <div class="mdl-cell mdl-cell-8-col-tablet mdl-cell--8-col-desktop" >
          <p>Enter an email and password below and either sign in to an existing account or sign up</p>
        </div>
        <div class="mdl-layout-spacer"></div>
      </div>
      <div class="mdl-grid">
        <div class="mdl-layout-spacer"></div>
        <div class="mdl-cell mdl-cell-8-col-tablet mdl-cell--8-col-desktop">
          <input type="text" id="email" name="email" placeholder="Email" />
          <input type="password" id="password" name="password" placeholder="Password" />
          <br />
          <button id="signin" name="signin">Sign In</button> <button id="signup" name="signup">Sign Up</button>
        </div>
        <div class="mdl-layout-spacer"></div>
      </div>
  </main>
  </div>
</body>
</html>
